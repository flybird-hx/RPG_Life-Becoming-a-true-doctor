<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå¸‚ä¹‹æ°´ï¼šRPGè§‰é†’æ‰‹å†Œ v3.0</title>
    <style>
        :root {
            --primary: #00f2ff; /* ç§‘æŠ€è“ */
            --secondary: #7000ff; /* æ·±ç´« */
            --bg: #0a0b1e; /* æ·±ç©ºé»‘èƒŒæ™¯ */
            --card-bg: #161b33; /* å¡ç‰‡èƒŒæ™¯ */
            --sidebar-bg: #11152b; /* ä¾§è¾¹æ èƒŒæ™¯ */
            --text: #e0e0e0;
            --gold: #ffd700;
            --success: #39ff14;
            --danger: #ff3860;
            --int-color: #3498db; /* æ™ºåŠ›è“ */
            --con-color: #e74c3c; /* ä½“è´¨çº¢ */
            --per-color: #2ecc71; /* æ„ŸçŸ¥ç»¿ */
            --cha-color: #9b59b6; /* é­…åŠ›ç´« */
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* ä¸»å®¹å™¨ï¼šæ§åˆ¶å·¦å³å¸ƒå±€ */
        .main-container {
            display: flex;
            width: 100%;
            max-width: 1000px;
            gap: 25px;
        }

        /* å·¦ä¾§è§’è‰²é¢æ¿ */
        .sidebar {
            flex: 1;
            min-width: 280px;
            background: var(--sidebar-bg);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.2);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        /* å³ä¾§ä»»åŠ¡é¢æ¿ */
        .content {
            flex: 2;
        }

        /* æ‰‹æœºç«¯é€‚é…ï¼šæ”¹ä¸ºä¸Šä¸‹å¸ƒå±€ */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .sidebar {
                position: relative;
                top: 0;
                width: 100%;
                min-width: auto;
                box-sizing: border-box;
            }
             body { padding: 10px; }
        }

        /* --- è§’è‰²é¢æ¿æ ·å¼ --- */
        .avatar-container {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        /* å¤´åƒå›¾ç‰‡ï¼šä½ å¯ä»¥æ›¿æ¢ src é“¾æ¥ */
        .avatar-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            box-shadow: 0 0 15px var(--primary);
            object-fit: cover;
            /* è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå ä½å›¾ï¼Œä½ å¯ä»¥æ¢æˆä½ è‡ªå·±çš„ */
            background-image: url('https://img.freepik.com/free-vector/mysterious-mafia-man-smoking-cigarette_52683-34828.jpg?w=740&t=st=1708675000~exp=1708675600~hmac=6413937628388750265605483215420403434343434343434343434343434343');
            background-size: cover;
        }

        .player-name { font-size: 1.2rem; font-weight: bold; margin-top: 10px; color: var(--primary); }
        .player-title { font-size: 0.9rem; color: #888; }
        
        .level-badge {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            position: relative;
        }
        .stat-label { font-size: 0.8rem; color: #aaa; margin-bottom: 5px;}
        .stat-value { font-size: 1.4rem; font-weight: bold; }
        .stat-bonus { font-size: 0.8rem; color: var(--success); position: absolute; top: 5px; right: 5px; }

        /* --- ä»»åŠ¡é¢æ¿æ ·å¼ (æ²¿ç”¨ä¹‹å‰çš„ï¼Œç¨ä½œè°ƒæ•´) --- */
        .header { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .section-title { color: var(--gold); font-size: 1.1rem; margin: 25px 0 15px; display: flex; justify-content: space-between; align-items: center;}
        
        .task-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid var(--secondary);
            transition: transform 0.2s;
        }
        .task-card:hover { transform: translateY(-2px); background: #1a203d;}
        .task-info { flex: 1; }
        .task-name { font-weight: bold; font-size: 1rem; margin-bottom: 4px;}
        .task-desc { font-size: 0.8rem; color: #aaa; }
        .task-pts { color: var(--success); font-weight: bold; margin-left: 15px; font-size: 0.9rem; white-space: nowrap;}
        input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--primary); cursor: pointer; margin-left: 15px;}

        .btn-submit {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            border: none; color: white; padding: 15px; border-radius: 12px;
            font-size: 1.1rem; font-weight: bold; margin-top: 30px; cursor: pointer;
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.4); width: 100%; transition: scale 0.2s;
        }
        .btn-submit:active { transform: scale(0.98); }

        .dashboard-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;
        }
        .dash-card { background: var(--card-bg); padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #333;}
        .dash-val { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .dash-lbl { font-size: 0.7rem; color: #888; }

    </style>
</head>
<body>

<div class="main-container">
    <aside class="sidebar">
        <div class="avatar-container">
            <img src="https://api.dicebear.com/7.x/pixel-art/svg?seed=DoctorDrainage" alt="Avatar" class="avatar-img">
            <div class="player-name">Dr. Drainage</div>
            <div class="player-title">åŸå¸‚æ°´ç³»ç»Ÿå®ˆæŠ¤è€…</div>
            <div class="level-badge" id="playerLevel">LV.1 è§ä¹ å­¦è€…</div>
        </div>

        <div class="stats-grid">
            <div class="stat-box" style="border-bottom: 3px solid var(--int-color);">
                <div class="stat-label">æ™ºåŠ› (INT)</div>
                <div class="stat-value" style="color: var(--int-color);" id="statINT">10</div>
                <div class="stat-bonus" id="bonusINT"></div>
            </div>
            <div class="stat-box" style="border-bottom: 3px solid var(--con-color);">
                <div class="stat-label">ä½“è´¨ (CON)</div>
                <div class="stat-value" style="color: var(--con-color);" id="statCON">10</div>
                <div class="stat-bonus" id="bonusCON"></div>
            </div>
            <div class="stat-box" style="border-bottom: 3px solid var(--per-color);">
                <div class="stat-label">æ„ŸçŸ¥ (PER)</div>
                <div class="stat-value" style="color: var(--per-color);" id="statPER">10</div>
                <div class="stat-bonus" id="bonusPER"></div>
            </div>
            <div class="stat-box" style="border-bottom: 3px solid var(--cha-color);">
                <div class="stat-label">é­…åŠ› (CHA)</div>
                <div class="stat-value" style="color: var(--cha-color);" id="statCHA">10</div>
                <div class="stat-bonus" id="bonusCHA"></div>
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; font-size: 0.8rem; color: #888;">
            <span style="color: var(--success)">ğŸ’¡ æˆé•¿æœºåˆ¶ï¼š</span><br>
            â€¢ æ¯ 600 XP æå‡ 1 çº§ï¼Œå…¨å±æ€§å¢åŠ ã€‚<br>
            â€¢ æ¯è¿ç»­å…¨å‹¤ 7 å¤©ï¼Œæ¿€æ´»å…¨å±æ€§åŠ æˆ Buffã€‚
        </div>
    </aside>

    <main class="content">
        <div class="header">
            <h2 style="margin:0; color:var(--primary); display: flex; align-items: center;">
                ğŸ•¹ï¸ æ¯æ—¥å‰¯æœ¬æ§åˆ¶å°
            </h2>
        </div>

        <div class="dashboard-grid">
             <div class="dash-card">
                <div class="dash-lbl">ç´¯è®¡ç§¯åˆ† (XP)</div>
                <div id="totalXP" class="dash-val">0</div>
            </div>
            <div class="dash-card">
                <div class="dash-lbl">è¿ç»­å…¨å‹¤ (Days)</div>
                <div id="streak" class="dash-val">0</div>
            </div>
             <div class="dash-card">
                <div class="dash-lbl">å¤æ´»å¸ (Life)</div>
                <div id="coins" class="dash-val" style="color:var(--gold)">0</div>
            </div>
        </div>
        <div id="todayStatus" style="text-align: center; font-size: 0.9rem; margin-bottom: 20px; color: #888;">
            çŠ¶æ€ï¼šç­‰å¾…å·²è¿æ¥ï¼Œå‡†å¤‡æ‰§è¡Œä»»åŠ¡...
        </div>


        <div class="section-title">
            <span>âš”ï¸ æ ¸å¿ƒå­¦æœ¯å‰¯æœ¬ (æ™ºåŠ›ä¸»åœº)</span> 
            <small style="font-weight: normal; color: #888; font-size: 0.8rem;">éœ€å…¨é€‰æ‰è®¡å…¨å‹¤</small>
        </div>
        <div id="core-tasks">
            </div>

        <div class="section-title">
            <span>ğŸ› ï¸ è‡ªæˆ‘æå‡å‰¯æœ¬ (ç»¼åˆèƒ½åŠ›)</span> 
            <small style="font-weight: normal; color: #888; font-size: 0.8rem;">æ»¡3é¡¹è®¡å…¨å‹¤</small>
        </div>
        <div id="side-tasks">
             </div>

        <button class="btn-submit" onclick="submitDay()">âš¡ ç»“æŸä»Šæ—¥å‰¯æœ¬ & ç»“ç®—</button>
        
        <div style="margin-top: 25px; color: #666; font-size: 0.8rem; text-align: center;">
            å½“å‰ç‰ˆæœ¬ï¼šv3.0 (Stats & Avatar Update)<br>
            æ•°æ®ä»…å­˜å‚¨äºæœ¬åœ°æµè§ˆå™¨
        </div>
    </main>
</div>

<script>
    // ================= é…ç½®åŒºåŸŸ =================
    // ç­‰çº§å¤´è¡”é…ç½®
    const levelTitles = [
        "è§ä¹ å­¦è€…", "åˆçº§ç ”ç©¶å‘˜", "ä¸­çº§å·¥ç¨‹å¸ˆ", "é«˜çº§ä¸“å®¶", 
        "èµ„æ·±åšå¯¼", "å­¦æœ¯æ³°æ–—", "ä¼ å¥‡å®—å¸ˆ", "æ°´ä¹‹åŠç¥"
    ];
    const XP_PER_LEVEL = 600; // å¤šå°‘ç»éªŒå‡ä¸€çº§

    // ä»»åŠ¡é…ç½®
    const coreTaskData = [
        { id: 'sci', name: 'SCI è®ºæ–‡æ”»åš', desc: 'æ—¶é•¿â‰¥2h æˆ– ç« èŠ‚æ›´æ–°', pts: 30 },
        { id: 'cfd', name: 'æ•°å€¼æ¨¡æ‹Ÿåˆ†æ', desc: '1ç»„æ•°æ®ç»˜å›¾+ç»“è®º', pts: 20 },
        { id: 'patent', name: 'ä¸“åˆ©æŠ¤åŸæ²³', desc: '1é¡¹æƒåˆ©è¦æ±‚æˆ–å®éªŒæ•°æ®', pts: 10 }
    ];

    const sideTaskData = [
        { id: 'stairs', name: 'çºµå‘ä½ç§» (ä½“è´¨)', desc: 'çˆ¬æ¥¼æ¢¯â‰¥20å±‚', pts: 10 },
        { id: 'core', name: 'æ ¸å¿ƒåŠ å›º (ä½“è´¨)', desc: 'å¹³æ¿æ”¯æ’‘/ç«¯è…¹', pts: 10 },
        { id: 'read', name: 'çµæ„Ÿæ•æ‰‹ (æ™ºåŠ›/æ„ŸçŸ¥)', desc: 'é˜…è¯»30min+éšç¬”', pts: 6 },
        { id: 'color', name: 'è§†ç•Œé‡æ„ (æ„ŸçŸ¥)', desc: 'è‰²å½©æ„å›¾å­¦ä¹ ', pts: 6 },
        { id: 'talk', name: 'å…±é¸£å…±æŒ¯ (é­…åŠ›)', desc: 'æ·±åº¦æ²Ÿé€š/å³å…´æ¼”è®²', pts: 8 }
    ];

    // ================= æ ¸å¿ƒé€»è¾‘å¼•æ“ =================
    // åˆå§‹åŒ–å­˜æ¡£
    let gameState = JSON.parse(localStorage.getItem('phd_rpg_state_v3')) || {
        totalXP: 0,
        streak: 0,
        coins: 0,
        lastDate: null
    };

    function saveGame() {
        localStorage.setItem('phd_rpg_state_v3', JSON.stringify(gameState));
        updateUI();
    }

    // --- æ ¸å¿ƒï¼šå±æ€§è®¡ç®—å¼•æ“ ---
    function calculateStats() {
        // 1. è®¡ç®—ç­‰çº§
        // ç­‰çº§ = æ€»ç»éªŒ / å‡çº§ç»éªŒ + 1 (ç¡®ä¿æœ€ä½æ˜¯1çº§)
        let level = Math.floor(gameState.totalXP / XP_PER_LEVEL) + 1;
        let titleIndex = Math.min(level - 1, levelTitles.length - 1);
        let currentTitle = levelTitles[titleIndex];

        // 2. è®¡ç®—åŸºç¡€å±æ€§ (éšç­‰çº§çº¿æ€§å¢é•¿ï¼Œåˆå§‹10ç‚¹ï¼Œæ¯çº§+5)
        let baseStat = 10 + (level - 1) * 5;

        // 3. è®¡ç®—å…¨å‹¤BuffåŠ æˆ (æ¯æ»¡7å¤©å…¨å‹¤ï¼Œå…¨å±æ€§+3)
        let streakBonus = Math.floor(gameState.streak / 7) * 3;

        return {
            level: level,
            title: currentTitle,
            finalINT: baseStat + streakBonus,
            finalCON: baseStat + streakBonus,
            finalPER: baseStat +
